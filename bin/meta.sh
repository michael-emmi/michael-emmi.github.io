#!/usr/bin/env bash

BUILD="build.ninja"
DATA="data/michaelemmi.yml"
OUTPUT="public"

echo -n > $BUILD
echo "# this file is generated by $0" >> $BUILD
echo >> $BUILD

echo "rule it" >> $BUILD
echo "  command = mustache \$in > \$out" >> $BUILD
echo >> $BUILD

echo "rule copy" >> $BUILD
echo "  command = cp -r \$in \$out" >> $BUILD
echo >> $BUILD

echo "rule mkdir" >> $BUILD
echo "  command = mkdir -p \$out" >> $BUILD
echo >> $BUILD

echo "build $OUTPUT: mkdir $OUTPUT" >> $BUILD

for template in layouts/*.mustache
do
  base=$(basename $template)
  html="$OUTPUT/${base%.*}"
  echo "build $html: it $DATA $template" >> $BUILD
done

echo "build $OUTPUT/css: copy css" >> $BUILD
